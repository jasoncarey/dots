#!/usr/bin/env bash

PLUGIN_DIR="$CONFIG_DIR/plugins"

# ---------- COLORS: MATERIAL PALENIGHT ----------
# P_BG=0xee292d3e      # bar background (slightly transparent)
P_BG=0xcc292d3e      # glassy
P_BG_STRONG=0xff292d3e
P_FG=0xff959dcb      # foreground
P_COMMENT=0xff676e95
P_ACCENT=0xffc3e88d  # green accent
P_RED=0xffff5370
P_ORANGE=0xfff78c6c
P_YELLOW=0xffffcb6b
P_GREEN=0xffc3e88d
P_BLUE=0xff82aaff
P_PURPLE=0xffc792ea

FONT="SF Mono:Regular:12.0"
ICON_FONT="SF Mono:Medium:12.0"

# ---------- BAR ----------
sketchybar --bar \
  height=30 \
  margin=0 \
  corner_radius=0 \
  color=$P_BG \
  blur_radius=30 \
  padding_left=8 \
  padding_right=8 \
  position=top \
  y_offset=0

# Defaults for all items
sketchybar --default \
  updates=when_shown \
  icon.font="$ICON_FONT" \
  icon.color=$P_COMMENT \
  icon.highlight_color=$P_ACCENT \
  label.font="$FONT" \
  label.color=$P_FG \
  label.highlight_color=$P_ACCENT \
  background.color=$P_BG_STRONG \
  background.corner_radius=6 \
  background.height=22 \
  padding_left=6 \
  padding_right=6

# ---------- SPACES (LEFT) ----------
for sid in 1 2 3 4 5; do
  sketchybar --add space space.$sid left \
             --set space.$sid \
               associated_space=$sid \
               icon="‚óè" \
               label="$sid" \
               label.color=$P_COMMENT \
               label.drawing=off \
               icon.highlight=on \
               icon.highlight_color=$P_ACCENT \
               background.color=$P_BG_STRONG \
               background.corner_radius=6 \
               background.height=22 \
               padding_left=6 \
               padding_right=6 \
               background.drawing=off \
               click_script="yabai -m space --focus $sid"
done

# Add a small separator after spaces
sketchybar --add item sep.left left \
  --set sep.left icon="|" \
                 icon.color=$P_COMMENT \
                 background.drawing=off \
                 label.drawing=off

# ---------- FRONT APP (CENTER) ----------
sketchybar --add item front_app center \
  --set front_app \
    drawing=off \
    script="$PLUGIN_DIR/front_app.sh" \
    icon.drawing=off \
    background.drawing=off \
  --subscribe front_app front_app_switched

# ---------- APPS IN CURRENT SPACE (CENTER-RIGHT) ----------
# sketchybar --add item space_apps center \
#   --set space_apps \
#     script="$PLUGIN_DIR/space_apps.sh" \
#     icon.drawing=off \
#     background.drawing=off \
#     updates=on \
#   --subscribe space_apps front_app_switched

# ---------- APPS IN CURRENT SPACE (CENTER) ----------
sketchybar --add item space_apps right \
  --set space_apps \
    script="$PLUGIN_DIR/space_apps_dynamic.sh" \
  --subscribe space_apps front_app_switched

# ---------- CLOCK (RIGHT) ----------
sketchybar --add item clock right \
  --set clock \
    update_freq=30 \
    script="date +'%a %H:%M'" \
    icon.drawing=off \
    label.color=$P_FG \
    background.color=$P_BG_STRONG \
    background.corner_radius=6

# ---------- YABAI FOCUSED WINDOW BORDER COLOR HINT ----------
# Optional: lightly indicate active window color to match bar accent
yabai -m config active_window_border_color $P_BLUE
yabai -m config normal_window_border_color 0xff444267
yabai -m config window_border on
yabai -m config window_border_width 3